<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>إعداد المستخدم - تطبيق متابعة الصلاة</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>🕌</text></svg>">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Tajawal', sans-serif;
        }
        .avatar-option, .color-option {
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .avatar-option:hover, .color-option:hover {
            transform: scale(1.1);
        }
        .avatar-option.selected {
            transform: scale(1.2);
            box-shadow: 0 0 0 3px #3B82F6;
        }
        .color-option.selected {
            transform: scale(1.2);
            box-shadow: 0 0 0 3px #ffffff, 0 0 0 6px #3B82F6;
        }
        .setup-card {
            animation: slideUp 0.6s ease-out;
        }
        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 min-h-screen">
    <div class="container mx-auto px-2 md:px-4 py-4 md:py-8">
        <!-- Header -->
        <div class="text-center mb-6 md:mb-8">
            <div class="text-4xl md:text-5xl mb-3 md:mb-4">🕌</div>
            <h1 class="text-2xl md:text-3xl font-bold text-gray-800 mb-2">إعداد المستخدم الجديد</h1>
            <p class="text-sm md:text-base text-gray-600">أدخل بياناتك لبدء استخدام التطبيق</p>
        </div>

        <!-- Setup Form -->
        <div class="max-w-2xl mx-auto">
            <div class="setup-card bg-white rounded-2xl shadow-xl p-4 md:p-8">
                <form id="setup-form" class="space-y-6 md:space-y-8">
                    <!-- Username Input -->
                    <div>
                        <label class="block text-lg md:text-xl font-bold text-gray-800 mb-3 md:mb-4">الاسم</label>
                        <input 
                            type="text" 
                            id="username" 
                            placeholder="أدخل اسمك"
                            class="w-full px-3 md:px-4 py-2 md:py-3 text-base md:text-lg border-2 border-gray-300 rounded-xl focus:border-blue-500 focus:outline-none transition-colors duration-300"
                            required
                        >
                    </div>

                    <!-- Avatar Selection -->
                    <div>
                        <label class="block text-lg md:text-xl font-bold text-gray-800 mb-3 md:mb-4">اختر الأفاتار</label>
                        <div class="grid grid-cols-4 gap-2 md:gap-4" id="avatar-options">
                            <div class="avatar-option bg-gray-100 rounded-xl p-2 md:p-4 text-center text-2xl md:text-4xl" data-avatar="👨">👨</div>
                            <div class="avatar-option bg-gray-100 rounded-xl p-2 md:p-4 text-center text-2xl md:text-4xl" data-avatar="👩">👩</div>
                            <div class="avatar-option bg-gray-100 rounded-xl p-2 md:p-4 text-center text-2xl md:text-4xl" data-avatar="🧔">🧔</div>
                            <div class="avatar-option bg-gray-100 rounded-xl p-2 md:p-4 text-center text-2xl md:text-4xl" data-avatar="👱‍♂️">👱‍♂️</div>
                            <div class="avatar-option bg-gray-100 rounded-xl p-2 md:p-4 text-center text-2xl md:text-4xl" data-avatar="👱‍♀️">👱‍♀️</div>
                            <div class="avatar-option bg-gray-100 rounded-xl p-2 md:p-4 text-center text-2xl md:text-4xl" data-avatar="🧕">🧕</div>
                            <div class="avatar-option bg-gray-100 rounded-xl p-2 md:p-4 text-center text-2xl md:text-4xl" data-avatar="👤">👤</div>
                            <div class="avatar-option bg-gray-100 rounded-xl p-2 md:p-4 text-center text-2xl md:text-4xl" data-avatar="🕌">🕌</div>
                        </div>
                    </div>

                    <!-- Color Selection -->
                    <div>
                        <label class="block text-lg md:text-xl font-bold text-gray-800 mb-3 md:mb-4">اختر اللون المفضل</label>
                        <div class="grid grid-cols-6 gap-2 md:gap-3" id="color-options">
                            <div class="color-option w-8 h-8 md:w-12 md:h-12 bg-blue-500 rounded-full" data-color="blue"></div>
                            <div class="color-option w-8 h-8 md:w-12 md:h-12 bg-green-500 rounded-full" data-color="green"></div>
                            <div class="color-option w-8 h-8 md:w-12 md:h-12 bg-purple-500 rounded-full" data-color="purple"></div>
                            <div class="color-option w-8 h-8 md:w-12 md:h-12 bg-red-500 rounded-full" data-color="red"></div>
                            <div class="color-option w-8 h-8 md:w-12 md:h-12 bg-yellow-500 rounded-full" data-color="yellow"></div>
                            <div class="color-option w-8 h-8 md:w-12 md:h-12 bg-pink-500 rounded-full" data-color="pink"></div>
                            <div class="color-option w-8 h-8 md:w-12 md:h-12 bg-indigo-500 rounded-full" data-color="indigo"></div>
                            <div class="color-option w-8 h-8 md:w-12 md:h-12 bg-teal-500 rounded-full" data-color="teal"></div>
                            <div class="color-option w-8 h-8 md:w-12 md:h-12 bg-orange-500 rounded-full" data-color="orange"></div>
                            <div class="color-option w-8 h-8 md:w-12 md:h-12 bg-cyan-500 rounded-full" data-color="cyan"></div>
                            <div class="color-option w-8 h-8 md:w-12 md:h-12 bg-gray-500 rounded-full" data-color="gray"></div>
                            <div class="color-option w-8 h-8 md:w-12 md:h-12 bg-emerald-500 rounded-full" data-color="emerald"></div>
                        </div>
                    </div>

                    <!-- Preview -->
                    <div class="bg-gray-50 rounded-xl p-4 md:p-6">
                        <h3 class="text-base md:text-lg font-bold text-gray-800 mb-3 md:mb-4 text-center">معاينة</h3>
                        <div class="text-center">
                            <div id="preview-avatar" class="text-4xl md:text-6xl mb-2">👤</div>
                            <div id="preview-name" class="text-lg md:text-xl font-bold text-gray-800 mb-2">اسمك هنا</div>
                            <div id="preview-color" class="w-6 h-6 md:w-8 md:h-8 bg-blue-500 rounded-full mx-auto"></div>
                        </div>
                    </div>

                    <!-- Buttons -->
                    <div class="flex flex-col md:flex-row gap-3 md:gap-4">
                        <button 
                            type="button" 
                            onclick="goBack()" 
                            class="w-full md:flex-1 bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-3 px-4 md:px-6 rounded-xl transition-colors duration-300 text-sm md:text-base"
                        >
                            العودة
                        </button>
                        <button 
                            type="submit" 
                            class="w-full md:flex-1 bg-gradient-to-r from-blue-500 to-indigo-600 hover:from-blue-600 hover:to-indigo-700 text-white font-bold py-3 px-4 md:px-6 rounded-xl transition-all duration-300 transform hover:scale-105 text-sm md:text-base"
                        >
                            حفظ وبدء الاستخدام
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Success Modal -->
    <div id="success-modal" class="fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm hidden items-center justify-center z-[99999]">
        <div class="bg-white rounded-2xl max-w-sm mx-4 shadow-2xl overflow-hidden transform transition-all duration-300 scale-95 opacity-0" id="success-modal-content">
            <!-- Modal Header -->
            <div class="bg-gradient-to-r from-green-500 to-emerald-600 text-white p-6 text-center">
                <div class="text-4xl mb-2">🎉</div>
                <h3 class="text-xl font-bold">تم إنشاء الحساب بنجاح!</h3>
            </div>
            
            <!-- Modal Body -->
            <div class="p-6 text-center">
                <p class="text-gray-700 mb-6 text-lg">مرحباً بك في تطبيق متابعة الصلاة<br>بارك الله فيك 🤲</p>
                
                <!-- Action Button -->
                <button onclick="proceedToDashboard()" class="w-full bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 text-white font-bold py-3 px-4 rounded-xl transition-all duration-300 transform hover:scale-105 shadow-md">
                    ابدأ الاستخدام ✨
                </button>
            </div>
        </div>
    </div>

    <script>
        let selectedAvatar = '👤';
        let selectedColor = 'blue';

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            // Set default selections
            document.querySelector('[data-avatar="👤"]').classList.add('selected');
            document.querySelector('[data-color="blue"]').classList.add('selected');
            
            updatePreview();
        });

        // Avatar selection
        document.getElementById('avatar-options').addEventListener('click', function(e) {
            if (e.target.classList.contains('avatar-option')) {
                // Remove previous selection
                document.querySelectorAll('.avatar-option').forEach(option => {
                    option.classList.remove('selected');
                });
                
                // Add selection to clicked option
                e.target.classList.add('selected');
                selectedAvatar = e.target.dataset.avatar;
                updatePreview();
            }
        });

        // Color selection
        document.getElementById('color-options').addEventListener('click', function(e) {
            if (e.target.classList.contains('color-option')) {
                // Remove previous selection
                document.querySelectorAll('.color-option').forEach(option => {
                    option.classList.remove('selected');
                });
                
                // Add selection to clicked option
                e.target.classList.add('selected');
                selectedColor = e.target.dataset.color;
                updatePreview();
            }
        });

        // Username input
        document.getElementById('username').addEventListener('input', updatePreview);

        function updatePreview() {
            const username = document.getElementById('username').value || 'اسمك هنا';
            document.getElementById('preview-avatar').textContent = selectedAvatar;
            document.getElementById('preview-name').textContent = username;
            document.getElementById('preview-color').className = `w-8 h-8 bg-${selectedColor}-500 rounded-full mx-auto`;
        }

        // Form submission
        document.getElementById('setup-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const username = document.getElementById('username').value.trim();
            
            if (!username) {
                alert('يرجى إدخال الاسم');
                return;
            }

            // Check if user already exists
            if (localStorage.getItem(`user_${username}`)) {
                alert('هذا الاسم مستخدم بالفعل. يرجى اختيار اسم آخر.');
                return;
            }

            // Create user profile
            const userProfile = {
                username: username,
                avatar: selectedAvatar,
                color: selectedColor,
                createdAt: new Date().toISOString()
            };

            // Save user profile
            localStorage.setItem(`user_${username}`, JSON.stringify(userProfile));
            localStorage.setItem('currentUser', username);

            // Show success modal
            showSuccessModal();
        });

        function goBack() {
            window.location.href = 'user-select.html';
        }

        function showSuccessModal() {
            const modal = document.getElementById('success-modal');
            const modalContent = document.getElementById('success-modal-content');
            
            modal.classList.remove('hidden');
            modal.classList.add('flex');
            
            setTimeout(() => {
                modalContent.classList.remove('scale-95', 'opacity-0');
                modalContent.classList.add('scale-100', 'opacity-100');
            }, 10);
        }

        function proceedToDashboard() {
            window.location.href = 'prayer-dashboard.html';
        }
    </script>
</body>
</html>